---
description: 透過提出最多 5 個高度針對性的釐清問題，並將答案編碼回規格中，以識別當前功能規格中規格不足的區域。
---

## 使用者輸入

```text
$ARGUMENTS
```

在繼續之前，您**必須**考慮使用者輸入（若非空）。

## 綱要

目標：偵測並減少當前功能規格中的模糊或缺失決策點，並將釐清內容直接記錄到規格檔案中。

注意：此釐清工作流程預計在調用 `/speckit.plan` **之前**執行（並完成）。如果使用者明確表示他們正在跳過釐清（例如，探索性的原型開發），您可以繼續，但必須警告下游重工風險會增加。

執行步驟：

1.  從儲存庫根目錄**一次性**執行 `.specify/scripts/powershell/check-prerequisites.ps1 -Json -PathsOnly`（組合的 `--json --paths-only` 模式 / `-Json -PathsOnly`）。解析最小的 JSON 酬載欄位：
    -   `FEATURE_DIR`
    -   `FEATURE_SPEC`
    -   （可選地擷取 `IMPL_PLAN`, `TASKS` 以供未來鏈式流程使用。）
    -   如果 JSON 解析失敗，則中止並指示使用者重新執行 `/speckit.specify` 或驗證功能分支環境。
    -   對於參數中如 "I'm Groot" 的單引號，請使用轉義語法：例如 'I'''m Groot'（或盡可能使用雙引號："I'm Groot"）。

2.  載入目前的規格檔案。使用此分類法執行結構化的模糊性與覆蓋範圍掃描。對於每個類別，標記狀態：清晰 / 部分 / 缺失。產生一個用於優先級排序的內部覆蓋圖（除非不提問，否則不要輸出原始圖）。

    功能範圍與行為：
    -   核心使用者目標與成功標準
    -   明確的超出範圍聲明
    -   使用者角色 / 人物誌區分

    領域與資料模型：
    -   實體、屬性、關係
    -   身份與唯一性規則
    -   生命週期/狀態轉換
    -   資料量 / 規模假設

    互動與使用者體驗流程：
    -   關鍵使用者旅程 / 序列
    -   錯誤/空白/載入狀態
    -   無障礙或本地化註記

    非功能性品質屬性：
    -   效能（延遲、吞吐量目標）
    -   可擴展性（水平/垂直、限制）
    -   可靠性與可用性（正常執行時間、恢復期望）
    -   可觀察性（日誌、指標、追蹤信號）
    -   安全性與隱私（驗證/授權、資料保護、威脅假設）
    -   合規性 / 法規限制（若有）

    整合與外部相依性：
    -   外部服務/API 及其失敗模式
    -   資料匯入/匯出格式
    -   協定/版本控制假設

    極端案例與失敗處理：
    -   負面情境
    -   速率限制 / 節流
    -   衝突解決（例如，並行編輯）

    限制與權衡：
    -   技術限制（語言、儲存、託管）
    -   明確的權衡或被拒絕的替代方案

    術語與一致性：
    -   規範的詞彙表術語
    -   避免使用的同義詞 / 已棄用的術語

    完成信號：
    -   驗收標準的可測試性
    -   可衡量的「完成定義」風格指標

    雜項 / 預留位置：
    -   TODO 標記 / 未解決的決策
    -   缺乏量化的模糊形容詞（「穩健」、「直觀」）

    對於每個狀態為「部分」或「缺失」的類別，新增一個候選問題機會，除非：
    -   釐清不會實質性地改變實作或驗證策略
    -   資訊延後到規劃階段更佳（內部註記）

3.  （內部）產生一個優先級排序的候選釐清問題佇列（最多 5 個）。**不要**一次性輸出所有問題。應用這些限制：
    -   整個會話中最多總共 10 個問題。
    -   每個問題必須可以用以下任一方式回答：
        -   一個簡短的多選題（2-5 個不同、互斥的選項），或
        -   一個單字 / 簡短片語的答案（明確限制：「答案 <=5 個字」）。
    -   僅包含其答案會實質性影響架構、資料建模、任務分解、測試設計、使用者體驗行為、營運準備或合規性驗證的問題。
    -   確保類別覆蓋平衡：首先嘗試涵蓋影響最大的未解決類別；避免在一個高影響領域（例如，安全態勢）未解決時，詢問兩個低影響問題。
    -   排除已回答、無關緊要的風格偏好或規劃層級的執行細節（除非阻礙正確性）的問題。
    -   偏好能減少下游重工風險或防止驗收測試不一致的釐清。
    -   如果超過 5 個類別仍未解決，則根據（影響 * 不確定性）啟發式選擇前 5 個。

4.  循序提問循環（互動式）：
    -   一次**只**提出一個問題。
    -   對於多選題：
        -   **分析所有選項**並根據以下因素決定**最合適的選項**：
            -   專案類型的最佳實踐
            -   類似實作中的常見模式
            -   風險降低（安全性、效能、可維護性）
            -   與規格中可見的任何明確專案目標或限制保持一致
        -   在頂部顯著位置呈現您的**建議選項**，並附上清晰的理由（1-2 句話解釋為何這是最佳選擇）。
        -   格式為：`**建議：** 選項 [X] - <理由>`
        -   然後將所有選項呈現為 Markdown 表格：

       | 選項 | 描述 |
       |--------|-------------|
       | A | <選項 A 描述> |
       | B | <選項 B 描述> |
       | C | <選項 C 描述>（視需要新增 D/E，最多 5 個）|
       | 簡答 | 提供一個不同的簡短答案（<=5 個字）（僅在自由格式替代方案合適時包含）|

       -   在表格後新增：`您可以回覆選項字母（例如，「A」），透過說「是」或「建議」來接受建議，或提供您自己的簡短答案。`
    -   對於簡答式（沒有有意義的離散選項）：
        -   根據最佳實踐和上下文提供您的**建議答案**。
        -   格式為：`**建議：** <您建議的答案> - <簡要理由>`
        -   然後輸出：`格式：簡短答案（<=5 個字）。您可以透過說「是」或「建議」來接受建議，或提供您自己的答案。`
    -   在使用者回答後：
        -   如果使用者回覆「是」、「建議」或「suggested」，則使用您先前陳述的建議/提議作為答案。
        -   否則，驗證答案是否對應到一個選項或符合 <=5 個字的限制。
        -   如果模稜兩可，要求快速消除歧義（計數仍屬於同一個問題；不前進）。
        -   一旦滿意，將其記錄在工作記憶中（尚不寫入磁碟）並移至下一個佇列中的問題。
    -   在以下情況停止提問：
        -   所有關鍵模糊點提早解決（剩餘的佇列項目變得不必要），或
        -   使用者發出完成信號（「完成」、「好了」、「不用了」），或
        -   您已問了 5 個問題。
    -   絕不提前透露未來的佇列問題。
    -   如果一開始沒有有效的問題，立即報告沒有關鍵的模糊點。

5.  每次接受答案後進行整合（增量更新方法）：
    -   維護規格的記憶體內表示（在開始時載入一次）以及原始檔案內容。
    -   對於此會話中第一個整合的答案：
        -   確保存在 `## 釐清` 區段（如果缺少，則根據規格範本在最高層級的上下文/概觀區段之後建立它）。
        -   在其下，為今天建立（如果不存在）一個 `### 會話 YYYY-MM-DD` 子標題。
    -   接受後立即附加一個項目符號行：`- Q: <問題> → A: <最終答案>`。
    -   然後立即將釐清應用到最合適的區段：
        -   功能性模糊 → 更新或在「功能性需求」中新增一個項目符號。
        -   使用者互動 / 角色區分 → 更新「使用者故事」或「角色」子區段（若存在），包含釐清的角色、限制或情境。
        -   資料形狀 / 實體 → 更新「資料模型」（新增欄位、類型、關係），保持順序；簡潔地註記新增的限制。
        -   非功能性限制 → 在「非功能性 / 品質屬性」區段新增/修改可衡量的標準（將模糊的形容詞轉換為指標或明確的目標）。
        -   極端案例 / 負面流程 → 在「極端案例 / 錯誤處理」下新增一個新的項目符號（或如果範本為其提供了預留位置，則建立此子區段）。
        -   術語衝突 → 在整個規格中標準化術語；僅在必要時保留原始術語，方法是新增一次 `(先前稱為 "X")`。
    -   如果釐清使先前的模糊陳述失效，則替換該陳述而不是重複；不留下過時的矛盾文本。
    -   **每次**整合後儲存規格檔案，以最小化內容遺失的風險（原子性覆寫）。
    -   保留格式：不要重新排序不相關的區段；保持標題層次結構完整。
    -   保持每個插入的釐清最小化且可測試（避免敘述性漂移）。

6.  驗證（在**每次**寫入後以及最終階段執行）：
    -   釐清會話中每個接受的答案只有一個項目符號（無重複）。
    -   總共提問（接受）的問題 ≤ 5。
    -   更新的區段不包含新答案旨在解決的任何殘留的模糊預留位置。
    -   沒有殘留的矛盾先前陳述（掃描已移除的無效替代選項）。
    -   Markdown 結構有效；只允許新的標題：`## 釐清`、`### 會話 YYYY-MM-DD`。
    -   術語一致性：在所有更新的區段中使用相同的規範術語。

7.  將更新後的規格寫回 `FEATURE_SPEC`。

8.  完成報告（在提問循環結束或提早終止後）：
    -   提問與回答的數量。
    -   更新後規格的路徑。
    -   觸及的區段（列出名稱）。
    -   覆蓋範圍摘要表，列出每個分類法類別的狀態：已解決（原為部分/缺失並已處理）、已延後（超出問題配額或更適合規劃）、清晰（已足夠）、待處理（仍為部分/缺失但影響低）。
    -   如果仍有任何「待處理」或「已延後」的項目，建議是繼續進行 `/speckit.plan` 還是稍後在規劃後再次執行 `/speckit.clarify`。
    -   建議的下一個命令。

行為規則：

-   如果沒有發現有意義的模糊點（或所有潛在問題的影響都很低），則回應：「未偵測到值得正式釐清的關鍵模糊點。」並建議繼續。
-   如果規格檔案缺失，指示使用者先執行 `/speckit.specify`（不要在此處建立新規格）。
-   總共提問的問題絕不超過 5 個（單一問題的釐清重試不計為新問題）。
-   除非缺乏功能性清晰度，否則避免提出推測性的技術棧問題。
-   尊重使用者提早終止的信號（「停止」、「完成」、「繼續」）。
-   如果因完全覆蓋而未提問，則輸出一個簡潔的覆蓋範圍摘要（所有類別均為「清晰」），然後建議前進。
-   如果達到配額但仍有未解決的高影響類別，則在「已延後」下明確標記它們並附上理由。

用於優先級排序的上下文：$ARGUMENTS
