---
description: 從自然語言功能描述建立或更新功能規格。
---

## 使用者輸入

```text
$ARGUMENTS
```

在繼續之前，您**必須**考慮使用者輸入（若非空）。

## 綱要

使用者在觸發訊息中於 `/speckit.specify` 後輸入的文字**就是**功能描述。假設即使下方出現 `$ARGUMENTS` 字樣，您在此對話中始終可以取用它。除非使用者提供了空命令，否則不要要求使用者重複。

給定該功能描述，請執行以下操作：

1.  **為分支產生一個簡潔的短名稱**（2-4 個字）：
    -   分析功能描述並提取最有意義的關鍵字
    -   建立一個 2-4 個字的短名稱，以捕捉功能的精髓
    -   盡可能使用「動作-名詞」格式（例如，「add-user-auth」、「fix-payment-bug」）
    -   保留技術術語和縮寫（OAuth2、API、JWT 等）
    -   保持簡潔，但描述性要足以讓人一眼就能理解功能
    -   範例：
        -   「我想要新增使用者驗證」→「user-auth」
        -   「為 API 實作 OAuth2 整合」→「oauth2-api-integration」
        -   「為分析建立一個儀表板」→「analytics-dashboard」
        -   「修正付款處理逾時錯誤」→「fix-payment-timeout」

2.  **在建立新分支前檢查現有分支**：

    a. 首先，擷取所有遠端分支以確保我們有最新資訊：
       ```bash
       git fetch --all --prune
       ```

    b. 在所有來源中尋找該短名稱的最高功能編號：
       -   遠端分支：`git ls-remote --heads origin | grep -E 'refs/heads/[0-9]+-<short-name>$'`
       -   本地分支：`git branch | grep -E '^[* ]*[0-9]+-<short-name>$'`
       -   規格目錄：檢查符合 `specs/[0-9]+-<short-name>` 的目錄

    c. 決定下一個可用的編號：
       -   從所有三個來源中提取所有編號
       -   找出最高編號 N
       -   新分支編號使用 N+1

    d. 使用計算出的編號和短名稱執行腳本 `.specify/scripts/powershell/create-new-feature.ps1 -Json "$ARGUMENTS"`：
       -   傳遞 `--number N+1` 和 `--short-name "your-short-name"` 以及功能描述
       -   Bash 範例：`.specify/scripts/powershell/create-new-feature.ps1 -Json "$ARGUMENTS" --json --number 5 --short-name "user-auth" "Add user authentication"`
       -   PowerShell 範例：`.specify/scripts/powershell/create-new-feature.ps1 -Json "$ARGUMENTS" -Json -Number 5 -ShortName "user-auth" "Add user authentication"`

    **重要**：
    -   檢查所有三個來源（遠端分支、本地分支、規格目錄）以找出最高編號
    -   僅匹配具有確切短名稱模式的分支/目錄
    -   如果找不到具有此短名稱的現有分支/目錄，則從編號 1 開始
    -   每個功能您只能執行此腳本一次
    -   JSON 會在終端機中作為輸出提供 - 請務必參考它以取得您正在尋找的實際內容
    -   JSON 輸出將包含 BRANCH_NAME 和 SPEC_FILE 路徑
    -   對於參數中如 "I'm Groot" 的單引號，請使用轉義語法：例如 'I'''m Groot'（或盡可能使用雙引號："I'm Groot"）

3.  載入 `.specify/templates/spec-template.md` 以了解必要的區段。

4.  遵循此執行流程：

    1.  從輸入中解析使用者描述
        如果為空：錯誤「未提供功能描述」
    2.  從描述中提取關鍵概念
        識別：角色、動作、資料、限制
    3.  對於不清楚的方面：
        -   根據上下文和行業標準做出明智的猜測
        -   僅在以下情況下標記 `[NEEDS CLARIFICATION: specific question]`：
            -   該選擇會顯著影響功能範圍或使用者體驗
            -   存在多種具有不同含義的合理解釋
            -   不存在合理的預設值
        -   **限制：總共最多 3 個 `[NEEDS CLARIFICATION]` 標記**
        -   按影響力對釐清進行優先排序：範圍 > 安全性/隱私 > 使用者體驗 > 技術細節
    4.  填寫「使用者情境與測試」區段
        如果沒有清晰的使用者流程：錯誤「無法確定使用者情境」
    5.  產生功能性需求
        每個需求都必須是可測試的
        對於未指定的細節使用合理的預設值（在「假設」區段中記錄假設）
    6.  定義成功標準
        建立可衡量、與技術無關的成果
        包括量化指標（時間、效能、數量）和質化衡量標準（使用者滿意度、任務完成度）
        每個標準都必須可以在不知道實作細節的情況下進行驗證
    7.  識別關鍵實體（如果涉及資料）
    8.  返回：成功（規格已準備好進行規劃）

5.  使用範本結構將規格寫入 SPEC_FILE，將預留位置替換為從功能描述（參數）推導出的具體細節，同時保留區段順序和標題。

6.  **規格品質驗證**：撰寫初始規格後，根據品質標準對其進行驗證：

    a. **建立規格品質檢查清單**：使用檢查清單範本結構在 `FEATURE_DIR/checklists/requirements.md` 建立一個檢查清單檔案，包含以下驗證項目：

       ```markdown
       # 規格品質檢查清單：[功能名稱]

       **目的**：在進行規劃前驗證規格的完整性和品質
       **建立日期**：[日期]
       **功能**：[連結至 spec.md]

       ## 內容品質

       - [ ] 無實作細節（語言、框架、API）
       - [ ] 專注於使用者價值和業務需求
       - [ ] 為非技術利害關係人撰寫
       - [ ] 所有強制性區段均已完成

       ## 需求完整性

       - [ ] 不再有 `[NEEDS CLARIFICATION]` 標記
       - [ ] 需求是可測試且無歧義的
       - [ ] 成功標準是可衡量的
       - [ ] 成功標準與技術無關（無實作細節）
       - [ ] 所有驗收情境均已定義
       - [ ] 已識別極端案例
       - [ ] 範圍已明確界定
       - [ ] 已識別相依性和假設

       ## 功能準備就緒

       - [ ] 所有功能性需求都有清晰的驗收標準
       - [ ] 使用者情境涵蓋主要流程
       - [ ] 功能符合「成功標準」中定義的可衡量成果
       - [ ] 沒有實作細節洩漏到規格中

       ## 備註

       -   標記為未完成的項目需要在 `/speckit.clarify` 或 `/speckit.plan` 之前更新規格
       ```

    b. **執行驗證檢查**：根據每個檢查清單項目審查規格：
       -   對於每個項目，確定其通過或失敗
       -   記錄發現的具體問題（引用相關的規格區段）

    c. **處理驗證結果**：

       -   **如果所有項目都通過**：將檢查清單標記為完成並繼續執行步驟 6

       -   **如果項目失敗（不包括 `[NEEDS CLARIFICATION]`）**：
           1.  列出失敗的項目和具體問題
           2.  更新規格以解決每個問題
           3.  重新執行驗證直到所有項目都通過（最多 3 次迭代）
           4.  如果 3 次迭代後仍然失敗，則在檢查清單備註中記錄剩餘問題並警告使用者

       -   **如果 `[NEEDS CLARIFICATION]` 標記仍然存在**：
           1.  從規格中提取所有 `[NEEDS CLARIFICATION: ...]` 標記
           2.  **限制檢查**：如果存在超過 3 個標記，則僅保留 3 個最關鍵的（按範圍/安全性/使用者體驗影響），並對其餘部分做出明智的猜測
           3.  對於每個需要的釐清（最多 3 個），以此格式向使用者呈現選項：

              ```markdown
              ## 問題 [N]：[主題]

              **上下文**：[引用相關的規格區段]

              **我們需要知道什麼**：[來自 NEEDS CLARIFICATION 標記的具體問題]

              **建議答案**：

              | 選項 | 答案 | 影響 |
              |--------|--------|--------------|
              | A      | [第一個建議答案] | [這對功能的意義] |
              | B      | [第二個建議答案] | [這對功能的意義] |
              | C      | [第三個建議答案] | [這對功能的意義] |
              | 自訂 | 提供您自己的答案 | [解釋如何提供自訂輸入] |

              **您的選擇**：_[等待使用者回應]_
              ```

           4.  **關鍵 - 表格格式**：確保 markdown 表格格式正確：
               -   使用一致的間距，管道對齊
               -   每個儲存格的內容周圍都應有空格：`| 內容 |` 而不是 `|內容|`
               -   標頭分隔符必須至少有 3 個破折號：`|--------|`
               -   測試表格在 markdown 預覽中是否正確呈現
           5.  循序編號問題（Q1、Q2、Q3 - 最多 3 個）
           6.  在等待回應前一次呈現所有問題
           7.  等待使用者對所有問題的選擇做出回應（例如，「Q1: A, Q2: 自訂 - [細節], Q3: B」）
           8.  透過將每個 `[NEEDS CLARIFICATION]` 標記替換為使用者選擇或提供的答案來更新規格
           9.  在所有釐清都解決後重新執行驗證

    d. **更新檢查清單**：每次驗證迭代後，使用目前的通過/失敗狀態更新檢查清單檔案

7.  報告完成情況，包含分支名稱、規格檔案路徑、檢查清單結果以及下一階段的準備情況（`/speckit.clarify` 或 `/speckit.plan`）。

**注意：** 腳本會建立並簽出新分支，並在寫入前初始化規格檔案。

## 一般指南

## 快速指南

-   專注於使用者**需要什麼**以及**為什麼**。
-   避免**如何**實作（沒有技術棧、API、程式碼結構）。
-   為業務利害關係人而非開發人員撰寫。
-   **不要**建立任何嵌入在規格中的檢查清單。這將是一個單獨的命令。

### 區段要求

-   **強制性區段**：每個功能都必須完成
-   **可選區段**：僅在與功能相關時包含
-   當一個區段不適用時，完全移除它（不要留作「不適用」）

### 對於 AI 產生

從使用者提示建立此規格時：

1.  **做出明智的猜測**：使用上下文、行業標準和常見模式來填補空白
2.  **記錄假設**：在「假設」區段中記錄合理的預設值
3.  **限制釐清**：最多 3 個 `[NEEDS CLARIFICATION]` 標記 - 僅用於以下關鍵決策：
    -   顯著影響功能範圍或使用者體驗
    -   存在多種具有不同含義的合理解釋
    -   缺乏任何合理的預設值
4.  **對釐清進行優先排序**：範圍 > 安全性/隱私 > 使用者體驗 > 技術細節
5.  **像測試人員一樣思考**：每個模糊的需求都應該在「可測試且無歧義」的檢查清單項目上失敗
6.  **需要釐清的常見領域**（僅在沒有合理的預設值時）：
    -   功能範圍和邊界（包括/排除特定使用案例）
    -   使用者類型和權限（如果可能存在多種相互衝突的解釋）
    -   安全性/合規性需求（當具有法律/財務意義時）

**合理預設值的範例**（不要詢問這些）：

-   資料保留：該領域的行業標準實踐
-   效能目標：標準的 Web/行動應用程式期望，除非另有規定
-   錯誤處理：使用者友善的訊息和適當的備援
-   驗證方法：Web 應用程式的標準基於會話或 OAuth2
-   整合模式：RESTful API，除非另有規定

### 成功標準指南

成功標準必須是：

1.  **可衡量的**：包括具體指標（時間、百分比、計數、速率）
2.  **與技術無關的**：不提及框架、語言、資料庫或工具
3.  **以使用者為中心的**：從使用者/業務角度描述成果，而非系統內部
4.  **可驗證的**：可以在不知道實作細節的情況下進行測試/驗證

**好的範例**：

-   「使用者可以在 3 分鐘內完成結帳」
-   「系統支援 10,000 個並行使用者」
-   「95% 的搜尋在 1 秒內返回結果」
-   「任務完成率提高 40%」

**不好的範例**（以實作為中心）：

-   「API 回應時間低於 200 毫秒」（過於技術性，使用「使用者立即看到結果」）
-   「資料庫可以處理 1000 TPS」（實作細節，使用面向使用者的指標）
-   「React 元件高效渲染」（特定於框架）
-   「Redis 快取命中率高於 80%」（特定於技術）
