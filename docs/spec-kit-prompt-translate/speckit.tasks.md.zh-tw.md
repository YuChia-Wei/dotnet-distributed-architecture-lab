---
description: 根據可用的設計產物，為功能產生一個可操作、按相依性排序的 tasks.md。
---

## 使用者輸入

```text
$ARGUMENTS
```

在繼續之前，您**必須**考慮使用者輸入（若非空）。

## 綱要

1.  **設定**：從儲存庫根目錄執行 `.specify/scripts/powershell/check-prerequisites.ps1 -Json` 並解析 FEATURE_DIR 和 AVAILABLE_DOCS 列表。所有路徑必須是絕對路徑。對於參數中如 "I'm Groot" 的單引號，請使用轉義語法：例如 'I'''m Groot'（或盡可能使用雙引號："I'm Groot"）。

2.  **載入設計文件**：從 FEATURE_DIR 讀取：
    -   **必要**：`plan.md`（技術棧、函式庫、結構）、`spec.md`（帶有優先順序的使用者故事）
    -   **可選**：`data-model.md`（實體）、`contracts/`（API 端點）、`research.md`（決策）、`quickstart.md`（測試情境）
    -   注意：並非所有專案都有所有文件。根據可用的內容產生任務。

3.  **執行任務產生工作流程**：
    -   載入 `plan.md` 並提取技術棧、函式庫、專案結構
    -   載入 `spec.md` 並提取帶有優先順序的使用者故事（P1、P2、P3 等）
    -   如果 `data-model.md` 存在：提取實體並對應到使用者故事
    -   如果 `contracts/` 存在：將端點對應到使用者故事
    -   如果 `research.md` 存在：提取決策以用於設定任務
    -   按使用者故事組織產生任務（請參閱下方的「任務產生規則」）
    -   產生顯示使用者故事完成順序的相依關係圖
    -   為每個使用者故事建立並行執行範例
    -   驗證任務完整性（每個使用者故事都有所有必要的任務，可獨立測試）

4.  **產生 tasks.md**：使用 `.specify.specify/templates/tasks-template.md` 作為結構，填入：
    -   來自 `plan.md` 的正確功能名稱
    -   階段 1：設定任務（專案初始化）
    -   階段 2：基礎任務（所有使用者故事的阻塞性先決條件）
    -   階段 3+：每個使用者故事一個階段（按 `spec.md` 中的優先順序）
    -   每個階段包括：故事目標、獨立測試標準、測試（如果要求）、實作任務
    -   最後階段：潤飾與跨領域關注點
    -   所有任務都必須遵循嚴格的檢查清單格式（請參閱「任務產生規則」）
    -   每個任務都有清晰的檔案路徑
    -   顯示故事完成順序的相依性區段
    -   每個故事的並行執行範例
    -   實作策略區段（MVP 優先、增量交付）

5.  **報告**：輸出產生的 `tasks.md` 的路徑和摘要：
    -   總任務數
    -   每個使用者故事的任務數
    -   識別出的並行機會
    -   每個故事的獨立測試標準
    -   建議的 MVP 範圍（通常僅為使用者故事 1）
    -   格式驗證：確認**所有**任務都遵循檢查清單格式（核取方塊、ID、標籤、檔案路徑）

用於任務產生的上下文：$ARGUMENTS

`tasks.md` 應該是立即可執行的——每個任務都必須足夠具體，以便 LLM 可以在沒有額外上下文的情況下完成它。

## 任務產生規則

**關鍵**：任務**必須**按使用者故事組織，以實現獨立的實作和測試。

**測試是可選的**：僅在功能規格中明確要求或使用者要求 TDD 方法時才產生測試任務。

### 檢查清單格式（必要）

每個任務**必須**嚴格遵循此格式：

```text
- [ ] [TaskID] [P?] [Story?] 帶有檔案路徑的描述
```

**格式元件**：

1.  **核取方塊**：**總是**以 `- [ ]`（markdown 核取方塊）開頭
2.  **任務 ID**：按執行順序的循序編號（T001、T002、T003...）
3.  **[P] 標記**：**僅**在任務可並行化時包含（不同檔案，對未完成的任務沒有相依性）
4.  **[Story] 標籤**：**僅**對使用者故事階段任務為必要
    -   格式：[US1]、[US2]、[US3] 等（對應到 `spec.md` 中的使用者故事）
    -   設定階段：**無**故事標籤
    -   基礎階段：**無**故事標籤
    -   使用者故事階段：**必須**有故事標籤
    -   潤飾階段：**無**故事標籤
5.  **描述**：帶有確切檔案路徑的清晰動作

**範例**：

-   ✅ 正確：`- [ ] T001 根據實作計畫建立專案結構`
-   ✅ 正確：`- [ ] T005 [P] 在 src/middleware/auth.py 中實作驗證中介軟體`
-   ✅ 正確：`- [ ] T012 [P] [US1] 在 src/models/user.py 中建立使用者模型`
-   ✅ 正確：`- [ ] T014 [US1] 在 src/services/user_service.py 中實作 UserService`
-   ❌ 錯誤：`- [ ] 建立使用者模型`（缺少 ID 和故事標籤）
-   ❌ 錯誤：`T001 [US1] 建立模型`（缺少核取方塊）
-   ❌ 錯誤：`- [ ] [US1] 建立使用者模型`（缺少任務 ID）
-   ❌ 錯誤：`- [ ] T001 [US1] 建立模型`（缺少檔案路徑）

### 任務組織

1.  **來自使用者故事 (`spec.md`)** - **主要組織**：
    -   每個使用者故事（P1、P2、P3...）都有自己的階段
    -   將所有相關元件對應到其故事：
        -   該故事所需的模型
        -   該故事所需的服務
        -   該故事所需的端點/UI
        -   如果要求測試：特定於該故事的測試
    -   標記故事相依性（大多數故事應該是獨立的）

2.  **來自合約**：
    -   將每個合約/端點 → 對應到它所服務的使用者故事
    -   如果要求測試：每個合約 → 在該故事階段的實作前進行合約測試任務 [P]

3.  **來自資料模型**：
    -   將每個實體對應到需要它的使用者故事
    -   如果實體服務於多個故事：放在最早的故事或設定階段
    -   關係 → 在適當的故事階段中的服務層任務

4.  **來自設定/基礎設施**：
    -   共享基礎設施 → 設定階段（階段 1）
    -   基礎/阻塞性任務 → 基礎階段（階段 2）
    -   特定於故事的設定 → 在該故事的階段內

### 階段結構

-   **階段 1**：設定（專案初始化）
-   **階段 2**：基礎（阻塞性先決條件 - **必須**在使用者故事之前完成）
-   **階段 3+**：按優先順序的使用者故事（P1、P2、P3...）
    -   在每個故事內：測試（如果要求）→ 模型 → 服務 → 端點 → 整合
    -   每個階段都應該是一個完整、可獨立測試的增量
-   **最後階段**：潤飾與跨領域關注點
