---
description: 從互動式或提供的原則輸入建立或更新專案章程，確保所有相依的範本保持同步。
---

使用者輸入可由代理程式直接提供，或在 `$ARGUMENTS` 中提供 - 在繼續提示之前，您 **必須** 考慮它 (如果非空)。

使用者輸入：

$ARGUMENTS

您正在 `.specify/memory/constitution.md` 更新專案章程。此檔案是一個範本，其中包含方括號中的預留位置權杖 (例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`)。您的工作是 (a) 收集/衍生具體值，(b) 精確填寫範本，以及 (c) 將任何修訂傳播到相依的成品中。

請遵循此執行流程：

1. 在 `.specify/memory/constitution.md` 載入現有的章程範本。
   - 識別 `[ALL_CAPS_IDENTIFIER]` 形式的每個預留位置權杖。
   **重要**：使用者可能需要比範本中使用的原則更少或更多。如果指定了數字，請尊重該數字 - 遵循一般範本。您將相應地更新文件。

2. 收集/衍生預留位置的值：
   - 如果使用者輸入 (對話) 提供了一個值，請使用它。
   - 否則，請從現有的 repo 內容 (README、文件、先前的章程版本，如果已嵌入) 推斷。
   - 對於治理日期：`RATIFICATION_DATE` 是原始採用日期 (如果未知，請詢問或標記為 TODO)，如果進行了變更，`LAST_AMENDED_DATE` 為今天，否則保留先前的日期。
   - `CONSTITUTION_VERSION` 必須根據語意版本設定規則遞增：
     * MAJOR：向後不相容的治理/原則移除或重新定義。
     * MINOR：新增了新原則/章節或實質性擴充了指南。
     * PATCH：釐清、措辭、錯字修正、非語意性的改進。
   - 如果版本提升類型不明確，請在最終確定之前提出推理。

3. 草擬更新後的章程內容：
   - 將每個預留位置替換為具體文字 (除了專案選擇尚未定義的、刻意保留的範本位置外，不應留下任何括號內的權杖——明確說明任何保留的原因)。
   - 保留標題階層，註解一旦被取代就可以移除，除非它們仍然提供釐清性的指南。
   - 確保每個原則章節：簡潔的名稱行、擷取不可協商規則的段落 (或項目符號清單)、如果不夠明顯，則提供明確的基本原理。
   - 確保治理章節列出修訂程序、版本設定原則和合規性審查期望。

4. 一致性傳播檢查清單 (將先前的檢查清單轉換為主動驗證)：
   - 閱讀 `.specify/templates/plan-template.md` 並確保任何「章程檢查」或規則與更新後的原則一致。
   - 閱讀 `.specify/templates/spec-template.md` 以了解範圍/需求的一致性——如果章程新增/移除了強制性章節或限制，請進行更新。
   - 閱讀 `.specify/templates/tasks-template.md` 並確保任務分類反映了由原則驅動的新增或移除的任務類型 (例如，可觀察性、版本設定、測試紀律)。
   - 閱讀 `.specify/templates/commands/*.md` 中的每個指令檔案 (包括此檔案)，以驗證在需要通用指南時，沒有過時的參考 (例如，僅限 CLAUDE 的代理程式特定名稱) 存在。
   - 閱讀任何執行階段指南文件 (例如 `README.md`、`docs/quickstart.md` 或代理程式特定的指南檔案，如果有的話)。更新對已變更原則的參考。

5. 產生同步影響報告 (更新後，在章程檔案頂部以 HTML 註解的形式前置)：
   - 版本變更：舊 → 新
   - 修改後的原則清單 (如果重新命名，則為舊標題 → 新標題)
   - 新增的章節
   - 移除的章節
   - 需要更新的範本 (✅ 已更新 / ⚠ 待處理) 與檔案路徑
   - 如果任何預留位置被刻意延後，則提供後續的 TODO。

6. 最終輸出前的驗證：
   - 沒有剩餘的未解釋的括號權杖。
   - 版本行與報告相符。
   - 日期為 ISO 格式 YYYY-MM-DD。
   - 原則是宣告式的、可測試的，並且沒有模糊的語言 (「應該」→ 在適當時以 MUST/SHOULD 的基本原理取代)。

7. 將完成的章程寫回 `.specify/memory/constitution.md` (覆寫)。

8. 向使用者輸出最終摘要，其中包含：
   - 新版本和提升的基本原理。
   - 任何標記為需要手動追蹤的檔案。
   - 建議的提交訊息 (例如 `docs: amend constitution to vX.Y.Z (principle additions + governance update)`)。

格式和樣式要求：
- 完全按照範本中的 Markdown 標題使用 (不要降級/升級層級)。
- 包裹長的理由行以保持可讀性 (理想情況下 <100 個字元)，但不要用尷尬的換行來強制執行。
- 在章節之間保留一個空白行。
- 避免尾隨空格。

如果使用者提供部分更新 (例如，只有一個原則修訂)，仍然執行驗證和版本決定步驟。

如果缺少關鍵資訊 (例如，批准日期真的未知)，請插入 `TODO(<FIELD_NAME>): explanation` 並將其包含在同步影響報告的延後項目下。

不要建立新範本；始終在現有的 `.specify/memory/constitution.md` 檔案上操作。
