# 摘要

本 PRD 描述「訂單（SaleOrders）」服務的現況與期望行為。服務提供下單與查詢訂單的 API，採用 Clean Architecture + DDD + CQRS，資料使用 PostgreSQL，訊息整合透過 Wolverine，並可依環境變數切換 Kafka 或 RabbitMQ。

現況重點（依程式碼盤點）：
- API：`POST /Orders` 建立訂單並回傳 `Guid`；`GET /Orders/{id}` 回傳 `OrderResponse`（Id, OrderDate, TotalAmount）。
- DTO 命名：輸入 `*Request`（`PlaceOrderRequest`），輸出 `*Response`（`OrderResponse`）。
- Domain：`Order` 聚合根建立時產生 `OrderPlacedDomainEvent`。
- 應用層：`PlaceOrderCommand` + Handler、`GetOrderByIdQuery` + Handler、`OrderDto`、`IOrderDomainRepository`。
- 基礎設施：Dapper + Npgsql；`OrderDomainRepository` 進行 CRUD（Insert/Select/Update/Delete），透過 `DomainEventDispatcher` 發送領域事件。
- 整合事件：`IntegrationEventPublisher` 以 Wolverine `IMessageBus` 發布 `IIntegrationEvent`；WebApi 端根據 `QUEUE_SERVICE` 將整合事件送至 Kafka Topic `orders` 或 RabbitMQ Queue `orders`。
- Consumer：專案存在並監聽 `products` Topic/Queue，但未見對應的處理器；可能用於接收產品領域事件，須確認用途或調整為處理 `orders` 相關事件。

風險與疑慮：
- Consumer 目前監聽 `products`，與 WebApi 發布的 `orders` 命名不一致，實際目標需澄清（跨域整合或命名錯誤）。
- 連線設定命名不一：WebApi 使用 `ConnectionStrings:KafkaBroker/MessageBroker`，Consumer 使用 `BrokerConnectionString`。建議統一。
